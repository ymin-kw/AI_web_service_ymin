<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¹”ë”í•œ íšŒì˜ë¡ ì‘ì„±ê¸°</title>
    <style>
        /* ê¹”ë”í•œ í™”ì´íŠ¸ í…Œë§ˆ ë””ìì¸ */
        :root {
            --primary-color: #007bff; /* íŒŒë€ìƒ‰ ê³„ì—´ (ê°•ì¡° ìƒ‰ìƒ) */
            --secondary-color: #28a745; /* ë…¹ìƒ‰ ê³„ì—´ (ë²„íŠ¼ ìƒ‰ìƒ) */
            --background-color: white; /* í°ìƒ‰ ë°°ê²½ */
            --text-color: #333333; /* ì–´ë‘ìš´ í…ìŠ¤íŠ¸ */
            --card-background: #f8f9fa; /* ì»´í¬ë„ŒíŠ¸ ë°°ê²½ (ì•½ê°„ íšŒìƒ‰) */
            --border-color: #ced4da; /* ê²½ê³„ì„  ìƒ‰ìƒ */
            --font-family: 'Malgun Gothic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 30px;
            line-height: 1.6;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
            margin-top: 0;
            font-size: 2em;
        }

        /* ì…ë ¥ í¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #input-area {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px; /* ì¶œë ¥ ê³µê°„ê³¼ ë¶„ë¦¬ */
        }

        h2 {
            color: var(--primary-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            margin-top: 0;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row > .form-group {
             flex: 1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        textarea {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: white;
            color: var(--text-color);
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        /* ì°¸ì„ì ë° ì•ˆê±´ ì¶”ê°€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .add-button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .add-button:hover {
            background-color: #1e7e34;
        }

        #attendees-list, #agenda-list {
            margin-top: 10px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .list-item {
            background-color: #ffffff;
            color: var(--text-color);
            padding: 5px 10px;
            margin-bottom: 5px;
            border-radius: 3px;
            border: 1px solid #dee2e6;
            display: inline-block;
            margin-right: 5px;
        }
        
        /* ë“±ë¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #register-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s, transform 0.1s;
        }

        #register-btn:hover {
            background-color: #0056b3;
        }
        
        #register-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* ìƒíƒœ/ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ (ì•„ë˜ì— ë„“ê²Œ ë°°ì¹˜) */
        #output-area {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #output-area h2 {
            color: var(--primary-color);
        }

        #status-message {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            background-color: #fff3cd; /* ê²½ê³  ìƒ‰ìƒ (ê¸°ë³¸) */
            color: #856404;
            font-weight: bold;
            min-height: 20px;
            border: 1px solid #ffeeba;
        }

        /* ë³µì‚¬í•˜ê¸° ì‰¬ìš´ ë„“ì€ ì¶œë ¥ ê³µê°„ */
        #result-content {
            white-space: pre-wrap;
            background-color: #ffffff; /* ì¶œë ¥ ê³µê°„ì€ ìˆœìˆ˜ í°ìƒ‰ */
            padding: 20px;
            border-radius: 4px;
            border: 2px solid #6c757d; /* ì§™ì€ ê²½ê³„ì„  */
            margin-top: 15px;
            min-height: 400px; /* ë„“ì€ ë†’ì´ í™•ë³´ */
            overflow-y: auto;
            font-family: Consolas, monospace;
            font-size: 0.95em;
            line-height: 1.5;
            cursor: text; /* í…ìŠ¤íŠ¸ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ */
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ“‘ ê¹”ë”í•œ íšŒì˜ë¡ ì‘ì„± ë° ì „ì†¡ ì‹œìŠ¤í…œ</h1>

        <div id="input-area">
            <h2>íšŒì˜ ì •ë³´ ì…ë ¥</h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="meeting-date">íšŒì˜ ì¼ì‹œ</label>
                    <input type="date" id="meeting-date" required>
                </div>
                <div class="form-group">
                    <label for="meeting-location">íšŒì˜ ì¥ì†Œ</label>
                    <input type="text" id="meeting-location" placeholder="ì˜ˆ: ê´‘ìš´ëŒ€ ìƒˆë¹›ê´€ 405í˜¸" required>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="start-time">íšŒì˜ ì‹œì‘ ì‹œê°„</label>
                    <input type="time" id="start-time" required>
                </div>
                <div class="form-group">
                    <label for="end-time">íšŒì˜ ì¢…ë£Œ ì‹œê°„</label>
                    <input type="time" id="end-time" required>
                </div>
            </div>

            <div class="form-group">
                <label for="attendee-input">íšŒì˜ ì°¸ì„ì</label>
                <input type="text" id="attendee-input" placeholder="ì°¸ì„ì ì´ë¦„ ì…ë ¥">
                <button type="button" class="add-button" onclick="addAttendee()">ì¶”ê°€</button>
                <div id="attendees-list"></div>
            </div>

            <div class="form-group">
                <label for="agenda-input">íšŒì˜ ë‚´ìš©/ì•ˆê±´</label>
                <textarea id="agenda-input" rows="4" placeholder="ì•ˆê±´ ë‚´ìš© ë° ê²°ì • ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”."></textarea>
                <button type="button" class="add-button" onclick="addAgenda()">ì•ˆê±´ ì¶”ê°€</button>
                <div id="agenda-list"></div>
            </div>

            <button type="button" id="register-btn" onclick="register()">íšŒì˜ë¡ ì „ì†¡ ë° AI ìƒì„± ìš”ì²­</button>
        </div>

        <div id="output-area">
            <h2>ì¶œë ¥ ê²°ê³¼ (Word ë¬¸ì„œ ë³µì‚¬ìš©)</h2>
            <div id="status-message">ì „ì†¡ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AIê°€ ìƒì„±í•œ íšŒì˜ë¡ì´ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            
            <p><strong>JSON êµ¬ì„± ë°ì´í„° (ë””ë²„ê¹…ìš©):</strong></p>
            <pre id="json-content" style="background-color: #f0f0f0; border: 1px dashed #aaa; padding: 15px; margin-bottom: 20px; overflow-x: auto; max-height: 200px;"></pre>

            <p><strong>Word ë¬¸ì„œ ë³µì‚¬ìš© í…ìŠ¤íŠ¸ (Ctrl+A, Ctrl+Cë¡œ ì „ì²´ ë³µì‚¬ ê°€ëŠ¥):</strong></p>
            <pre id="result-content" tabindex="0"></pre>
        </div>
    </div>

    <script>
        // í•µì‹¬ ìš”êµ¬ ì‚¬í•­ 1: ë¡œì»¬ ë°±ì—”ë“œ ì„œë²„ ì£¼ì†Œ ì„¤ì •
        const SERVER_URL = 'https://9a809f96-16c8-4e98-b263-a895e4033d05-00-1115s3je3tzzn.pike.replit.dev/generate_minutes';

        let attendees = [];
        let agendas = [];

        function addAttendee() {
            const input = document.getElementById('attendee-input');
            const name = input.value.trim();

            if (name && !attendees.includes(name)) {
                attendees.push(name);
                input.value = '';
                renderAttendees();
            } else if (name) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì°¸ì„ìì…ë‹ˆë‹¤.');
            }
        }

        function renderAttendees() {
            const listDiv = document.getElementById('attendees-list');
            listDiv.innerHTML = attendees.map(att => 
                `<span class="list-item">${att}</span>`
            ).join('');
        }

        function addAgenda() {
            const input = document.getElementById('agenda-input');
            const content = input.value.trim();

            if (content) {
                agendas.push(content);
                input.value = '';
                renderAgendas();
            }
        }

        function renderAgendas() {
            const listDiv = document.getElementById('agenda-list');
            // ì•ˆê±´ ëª©ë¡ì„ ê°„ë‹¨í•˜ê²Œ í‘œì‹œ
            listDiv.innerHTML = agendas.map((agenda, index) => 
                `<span class="list-item">ì•ˆê±´ ${index + 1} (${agenda.substring(0, 15)}...)</span>`
            ).join('');
        }

        /**
         * íšŒì˜ë¡ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì„œë²„ë¡œ ì „ì†¡í•˜ê³ , ì¶œë ¥ ê³µê°„ì— ë³µì‚¬í•˜ê¸° ì¢‹ì€ í˜•íƒœë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
         */
        async function register() {
            const date = document.getElementById('meeting-date').value;
            const startTime = document.getElementById('start-time').value;
            const endTime = document.getElementById('end-time').value;
            const location = document.getElementById('meeting-location').value;
            const statusMessage = document.getElementById('status-message');
            const jsonContent = document.getElementById('json-content');
            const resultContent = document.getElementById('result-content');
            const registerBtn = document.getElementById('register-btn');

            // í•„ìˆ˜ ì…ë ¥ í•„ë“œ í™•ì¸
            if (!date || !startTime || !endTime || !location || attendees.length === 0 || agendas.length === 0) {
                statusMessage.textContent = 'ì˜¤ë¥˜: ëª¨ë“  í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì°¸ì„ì ë° ì•ˆê±´ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.';
                statusMessage.style.backgroundColor = '#f8d7da';
                statusMessage.style.color = '#721c24';
                return;
            }

            // ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ ìš”ì²­ ë°©ì§€)
            registerBtn.disabled = true;
            registerBtn.textContent = "â³ AIê°€ íšŒì˜ë¡ì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)";
            statusMessage.textContent = "ì„œë²„ì™€ í†µì‹  ì¤‘ì…ë‹ˆë‹¤...";
            statusMessage.style.backgroundColor = '#fff3cd';
            statusMessage.style.color = '#856404';

            // =========================================================================
            // 1. Word ë¬¸ì„œ ë³µì‚¬ìš© í…ìŠ¤íŠ¸ êµ¬ì„± (ê¸°ë³¸ ì •ë³´)
            // =========================================================================
            const baseText = createWordDocumentText(date, startTime, endTime, location, attendees, agendas);
            resultContent.textContent = baseText; // ì¼ë‹¨ ê¸°ë³¸ ì •ë³´ ë¨¼ì € í‘œì‹œ

            // =========================================================================
            // 2. API ì „ì†¡ìš© ë°ì´í„° êµ¬ì„± (ë°±ì—”ë“œ í¬ë§·ì— ë§ì¶¤)
            // =========================================================================
            // ë°±ì—”ë“œì˜ MeetingData ëª¨ë¸ì€ title, participants, contentë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.
            const backendPayload = {
                title: `${date} ${location} íšŒì˜`,
                participants: attendees,
                // í”„ë¡ íŠ¸ì—ì„œ ì •ë¦¬í•œ ê¹”ë”í•œ í…ìŠ¤íŠ¸ë¥¼ AIì—ê²Œ 'ë‚´ìš©'ìœ¼ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
                content: baseText 
            };

            // ë””ë²„ê¹…ìš© JSON ì¶œë ¥
            jsonContent.textContent = JSON.stringify(backendPayload, null, 2);

            // =========================================================================
            // 3. fetch í•¨ìˆ˜ë¥¼ ì´ìš©í•œ POST í†µì‹  ë¡œì§
            // =========================================================================
            try {
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(backendPayload), 
                });

                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜! ìƒíƒœ ì½”ë“œ: ${response.status}`);
                }

                const aiData = await response.json();
                
                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                statusMessage.textContent = 'ğŸ‰ AI íšŒì˜ë¡ ìƒì„± ì™„ë£Œ! ì•„ë˜ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.';
                statusMessage.style.backgroundColor = '#d4edda';
                statusMessage.style.color = '#155724';

                // =========================================================================
                // 4. AI ì‘ë‹µ ê²°ê³¼ë¥¼ Word í…ìŠ¤íŠ¸ì— ì¶”ê°€
                // =========================================================================
                let finalText = baseText;
                
                finalText += "\n\n========================================================\n";
                finalText += "                 [AI ìƒì„± ê²°ê³¼]                 \n";
                finalText += "========================================================\n\n";
                
                finalText += "ğŸ“Œ 3ì¤„ ìš”ì•½\n";
                finalText += "--------------------------------------------------------\n";
                finalText += `${aiData.summary}\n\n`;

                if (aiData.decisions && aiData.decisions.length > 0) {
                    finalText += "âœ… ê²°ì •ëœ ì‚¬í•­ (AI ì¶”ì¶œ)\n";
                    finalText += "--------------------------------------------------------\n";
                    aiData.decisions.forEach(item => {
                        finalText += `- ${item}\n`;
                    });
                    finalText += "\n";
                }

                if (aiData.action_items && aiData.action_items.length > 0) {
                    finalText += "âš¡ Action Items (í•  ì¼)\n";
                    finalText += "--------------------------------------------------------\n";
                    aiData.action_items.forEach(item => {
                        finalText += `- [${item.assignee}] ${item.task} (~${item.due_date})\n`;
                    });
                    finalText += "\n";
                }

                if (aiData.dialogue_script && aiData.dialogue_script.length > 0) {
                    finalText += "ğŸ’¬ ëŒ€í™” ì‹œë‚˜ë¦¬ì˜¤ ì¬êµ¬ì„±\n";
                    finalText += "--------------------------------------------------------\n";
                    aiData.dialogue_script.forEach(chat => {
                        finalText += `${chat.speaker}: ${chat.text}\n`;
                    });
                }

                // ìµœì¢… ê²°ê³¼ë¥¼ í™”ë©´ì— ì—…ë°ì´íŠ¸
                resultContent.textContent = finalText;
                resultContent.focus(); // ë°”ë¡œ ë³µì‚¬í•  ìˆ˜ ìˆê²Œ í¬ì»¤ìŠ¤

            } catch (error) {
                console.error('API í†µì‹  ì˜¤ë¥˜:', error);
                statusMessage.textContent = `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message} (ë°±ì—”ë“œ ì„œë²„ê°€ ì¼œì ¸ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”)`;
                statusMessage.style.backgroundColor = '#f8d7da';
                statusMessage.style.color = '#721c24';
            } finally {
                // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                registerBtn.disabled = false;
                registerBtn.textContent = "íšŒì˜ë¡ ì „ì†¡ ë° AI ìƒì„± ìš”ì²­";
            }
        }

        /**
         * ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function calculateDuration(start, end) {
            const startParts = start.split(':').map(Number);
            const endParts = end.split(':').map(Number);

            const startMinutes = startParts[0] * 60 + startParts[1];
            const endMinutes = endParts[0] * 60 + endParts[1];

            let diffMinutes = endMinutes - startMinutes;
            if (diffMinutes < 0) {
                 diffMinutes += 24 * 60;
            }

            const hours = Math.floor(diffMinutes / 60);
            const minutes = diffMinutes % 60;

            return `${hours}ì‹œê°„ ${minutes}ë¶„`;
        }

        /**
         * Word ë¬¸ì„œì— ë³µì‚¬í•˜ê¸° ì¢‹ì€ í˜•ì‹ì˜ í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function createWordDocumentText(date, start, end, location, attendees, agendas) {
            let text = "";
            text += "========================================================\n";
            text += "                 íšŒì˜ë¡ (Meeting Minutes)               \n";
            text += "========================================================\n\n";

            text += "1. íšŒì˜ ê°œìš”\n";
            text += "--------------------------------------------------------\n";
            text += `* ì¼ì‹œ: ${date} \n`;
            text += `* ì‹œê°„: ${start} ~ ${end} (${calculateDuration(start, end)})\n`;
            text += `* ì¥ì†Œ: ${location}\n`;
            text += `* ì°¸ì„ì: ${attendees.join(', ')}\n\n`;

            text += "2. íšŒì˜ ì•ˆê±´ (Raw Data)\n";
            text += "--------------------------------------------------------\n";
            
            agendas.forEach((agenda, index) => {
                text += `\n[ì•ˆê±´ ${index + 1}]\n`;
                text += `  - ë‚´ìš©: ${agenda}\n`;
            });
            
            return text;
        }

        // ì´ˆê¸° ë Œë”ë§ ë° ê¸°ë³¸ê°’ ì„¤ì •
        document.addEventListener('DOMContentLoaded', () => {
            renderAttendees();
            renderAgendas();
            
            const now = new Date();
            const dateStr = now.toISOString().substring(0, 10);
            document.getElementById('meeting-date').value = dateStr;

            document.getElementById('start-time').value = '10:00';
            document.getElementById('end-time').value = '11:30';
        });

    </script>
</body>
</html>

